openapi: 3.0.3
info:
  title: Product Service API
  version: 1.0.0
  description: Basic contract for ProductController (list, create, update, getById)

servers:
  - url: /api/v1

tags:
  - name: Products
    description: Product operations

paths:
  /products:
    get:
      tags: [Products]
      operationId: listProducts
      summary: List products (paginated)
      parameters:
        - name: page
          in: query
          description: 0-based page index
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
        - name: size
          in: query
          description: Page size
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 20
        - name: q
          in: query
          description: Optional search query (name/sku)
          required: false
          schema:
            type: string
            maxLength: 100
        - name: sort
          in: query
          description: Sort fields (e.g., name,asc or createdAt,desc)
          required: false
          schema:
            type: string
            maxLength: 50
      responses:
        "200":
          description: Paged product list
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PagedProductResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalServerError"

    post:
      tags: [Products]
      operationId: createProduct
      summary: Create a product
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateProductRequest"
      responses:
        "201":
          description: Product created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProductResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /products/{id}:
    get:
      tags: [Products]
      operationId: getProductById
      summary: Get product by id
      parameters:
        - name: id
          in: path
          description: Product identifier (UUID)
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Product
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProductResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    put:
      tags: [Products]
      operationId: updateProduct
      summary: Update product by id
      parameters:
        - name: id
          in: path
          description: Product identifier (UUID)
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateProductRequest"
      responses:
        "200":
          description: Product updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProductResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"
        "500":
          $ref: "#/components/responses/InternalServerError"

components:
  schemas:
    CreateProductRequest:
      type: object
      required: [name, price]
      additionalProperties: false
      properties:
        name:
          type: string
          minLength: 2
          maxLength: 120
          example: "Wireless Mouse"
        sku:
          type: string
          minLength: 2
          maxLength: 64
          example: "MOUSE-WL-001"
        description:
          type: string
          maxLength: 1000
          example: "Ergonomic wireless mouse"
        price:
          type: number
          format: double
          minimum: 0
          example: 199.90
        currency:
          type: string
          minLength: 3
          maxLength: 3
          example: "TRY"
        isActive:
          type: boolean
          default: true
          example: true

    UpdateProductRequest:
      type: object
      required: [name, price, isActive]
      additionalProperties: false
      properties:
        name:
          type: string
          minLength: 2
          maxLength: 120
          example: "Wireless Mouse Pro"
        sku:
          type: string
          minLength: 2
          maxLength: 64
          example: "MOUSE-WL-001"
        description:
          type: string
          maxLength: 1000
          example: "Updated description"
        price:
          type: number
          format: double
          minimum: 0
          example: 249.90
        currency:
          type: string
          minLength: 3
          maxLength: 3
          example: "TRY"
        isActive:
          type: boolean
          example: true

    ProductResponse:
      type: object
      additionalProperties: false
      properties:
        id:
          type: string
          format: uuid
          example: "c1a1e5c2-6b9b-4a6f-8c72-0f0f6a2f2b1a"
        name:
          type: string
          example: "Wireless Mouse"
        sku:
          type: string
          example: "MOUSE-WL-001"
        description:
          type: string
          example: "Ergonomic wireless mouse"
        price:
          type: number
          format: double
          example: 199.90
        currency:
          type: string
          example: "TRY"
        isActive:
          type: boolean
          example: true
        createdAt:
          type: string
          format: date-time
          example: "2026-02-02T08:15:30Z"
        updatedAt:
          type: string
          format: date-time
          example: "2026-02-02T08:15:30Z"

    PagedProductResponse:
      type: object
      additionalProperties: false
      properties:
        items:
          type: array
          items:
            $ref: "#/components/schemas/ProductResponse"
        page:
          type: integer
          example: 0
        size:
          type: integer
          example: 20
        totalItems:
          type: integer
          example: 125
        totalPages:
          type: integer
          example: 7

    ErrorResponse:
      type: object
      additionalProperties: false
      required: [code, message, correlationId]
      properties:
        code:
          type: string
          example: "VALIDATION_ERROR"
        message:
          type: string
          example: "Validation failed."
        details:
          type: array
          items:
            type: string
          example:
            - "name: must not be blank"
        correlationId:
          type: string
          example: "3f2c2c4e6b3b4d3a9f6c0e3f0b8f0a12"
        timestamp:
          type: string
          format: date-time
          example: "2026-02-02T08:15:30Z"

  responses:
    BadRequest:
      description: Bad request (validation or malformed input)
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            validationError:
              value:
                code: "VALIDATION_ERROR"
                message: "Validation failed."
                details: ["name: must not be blank"]
                correlationId: "3f2c2c4e6b3b4d3a9f6c0e3f0b8f0a12"
                timestamp: "2026-02-02T08:15:30Z"

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            notFound:
              value:
                code: "NOT_FOUND"
                message: "Product not found."
                details: []
                correlationId: "3f2c2c4e6b3b4d3a9f6c0e3f0b8f0a12"
                timestamp: "2026-02-02T08:15:30Z"

    Conflict:
      description: Conflict (e.g., duplicate SKU)
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            conflict:
              value:
                code: "CONFLICT"
                message: "SKU already exists."
                details: []
                correlationId: "3f2c2c4e6b3b4d3a9f6c0e3f0b8f0a12"
                timestamp: "2026-02-02T08:15:30Z"

    InternalServerError:
      description: Unexpected error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
          examples:
            serverError:
              value:
                code: "INTERNAL_ERROR"
                message: "Unexpected error occurred."
                details: []
                correlationId: "3f2c2c4e6b3b4d3a9f6c0e3f0b8f0a12"
                timestamp: "2026-02-02T08:15:30Z"
